!function(a,b,c,d,e,f){"use strict";function g(a,b,c,d,e){var f,g=[];for(var h in a)if(a.hasOwnProperty(h))if(f=a[h],f[b]==c){if(e)return f[e];if(!d)return f;g.push(f)}else{var i=String.prototype.split.call(b,"_");if(i.length>1&&f[i[0]][i[1]]==c)return e?f[i[0]][e]:f[i[0]]}return g}function h(a){a=a.replace("#","");var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),d=parseInt(a.substr(4,2),16),e=(299*b+587*c+114*d)/1e3;return e>=128?"black":"white"}function i(){a.json(n.join(""),function(d){function l(a){var d=f();for(var h in b)if(b.hasOwnProperty(h)){var i=b[h];i.symbol=h,i.name=g(a,"symbol",h,!1,"Name"),i.price=g(a,"symbol",h,!1,"LastTradePriceOnly"),i.sub_industry_id=e[h],i.sub_industry_name=c[i.sub_industry_id].name,i.sector_id=parseInt(String(i.sub_industry_id).slice(0,2),10),i.value=Math.round(i.price*i.qty),n(d,i)}return m(d),d}function m(a){for(var b=a.children.length;b>0;){var c=a.children[--b];c.value||(c.children?m(c):a.children.splice(b,1))}}function n(a,b){var c=b.sub_industry_name;return a.name===c?(a.children=a.children||[],a.sector_id=b.sector_id,a.children.push(b),!0):a.children?(a.children.forEach(function(a){return n(a,b)?(a.sector_id=b.sector_id,!0):void 0}),!1):!1}function A(a){a.x=a.y=0,a.dx=o,a.dy=p,a.depth=0}function B(a){return(a._children=a.children)?a.value=a.children.reduce(function(a,b){return b.sector_id=b.children&&b.children.length?b.children[0].sector_id:b.sector_id,a+B(b)},0):a.value}function C(a){var b=[];return a+=14,b.push("0,0"),b.push(a+",0"),b.push(a+7+",15"),b.push(a+",30"),b.push("0,30"),b.push("7,15"),b.join(" ")}function D(b){x=0;var c=[];for(v.datum(b.parent).selectAll("g").remove(),c.unshift(b);b.parent;)c.unshift(b.parent),b=b.parent;for(var d=0;d<c.length;d++){var e=c[d],f=a.select(".trail").append("g");f.datum(e);var g=f.append("polygon").attr("fill",function(a){return r(a.sector_id||0)}).style("stroke","#dddddd"),i=f.append("text").text(""+e.name).attr("y",15).attr("x",d>0?12:8).attr("dy","0.35em").attr("class","breadcumb-text").style("fill",function(a){return h(r(a.sector_id||0))}),k=i[0][0].offsetWidth;g.attr("points",C(k)).on("click",function(a){j(a)}),f.attr("transform",function(){return"translate("+(10*d+x)+", 0)"}),x+=k+6}v.select(".trail").style("visibility","")}function E(a){a._children&&(u.nodes({_children:a._children}),a._children.forEach(function(b){b.x=a.x+b.x*a.dx,b.y=a.y+b.y*a.dy,b.dx*=a.dx,b.dy*=a.dy,b.parent=a,b.fill=h(r(b.sector_id||0)),E(b)}))}function F(a){function b(a,b){if(!k&&a){k=!0;var c=F(a),d=e.transition().duration(750),f=c.transition().duration(750);s.domain([a.x,a.x+a.dx]),t.domain([a.y,a.y+a.dy]),z.style("shape-rendering",null),0!==a.depth&&b&&z.selectAll(".depth").sort(function(a,b){return a.depth-b.depth}),c.selectAll("text").style("fill-opacity",0),d.selectAll("text").call(G).style("fill-opacity",0),f.selectAll("text").call(G).style("fill-opacity",1),d.selectAll("rect").call(H),f.selectAll("rect").call(H),d.remove().each("end",function(){z.style("shape-rendering","crispEdges"),k=!1}),k=!1}}function d(a){var d=w.append("g").attr("display","table-cell");a._children.forEach(function(a){var e=d.append("rect").attr("height",30).attr("fill",r(a.sector_id||0)).attr("y",0).attr("overflow-x","visible").datum(a).on("click",b),f=d.append("text").text(function(){return g(c,"sector_id",a.sector_id,!1,"name")}).attr("y",17).attr("fill",h(r(a.sector_id||0))).on("click",b),i=f[0][0].offsetWidth;e.attr("width",i+17).attr("x",x),f.attr("x",8+x),x+=i+16}),y=!0}var e=z.insert("g").datum(a).attr("class","depth"),f=e.selectAll("g").data(a._children).enter().append("g");return f.filter(function(a){return a._children}).classed("children",!0).on("click",b),f.selectAll(".child").data(function(a){return a._children||[a]}).enter().append("rect").attr("class","child").call(H),f.append("text").attr("class",function(a){return a.qty?"holding":"binLabel"}).attr("dy",".75em").attr("fill",h(r(a.sector_id||0))).text(function(a){return a.qty?a.name+" ("+a.symbol+")":a.name}).call(G),f.append("text").attr("class","currency").attr("dy","1.75em").text(function(a){return q(a.value)}).call(G),j=function(a){b(a,!0)},!y&&d(J),D(a),f}function G(a){a.attr("x",function(a){return s(a.x)+6}).attr("y",function(a){return t(a.y)+6}).attr("fill",function(a){return h(r(a.sector_id||0))})}function H(a){return a.attr("x",function(a){return s(a.x)}).attr("y",function(a){return t(a.y)}).attr("width",function(a){return s(a.x+a.dx)-s(a.x)}).attr("height",function(a){return t(a.y+a.dy)-t(a.y)}).attr("fill",function(a){return r(a.sector_id||0)}),a}d.query.results||i();var I=d.query.results.quote,J=l(I);A(J),B(J),E(J),F(J)})}var j,k,l=a.keys(b).join(","),m=['select symbol, Name, LastTradePriceOnly from yahoo.finance.quotes where symbol in ("',l,'")'],n=["https://query.yahooapis.com/v1/public/yql?q=",m.join(" "),"&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys"],o=1e3,p=500,q=(a.format(",d"),a.format("$,d")),r=a.scale.ordinal().domain(d).range(PALETTE),s=a.scale.linear().domain([0,o]).range([0,o]),t=a.scale.linear().domain([0,p]).range([0,p]),u=a.layout.treemap().children(function(a,b){return b?null:a._children}).sort(function(a,b){return a.value-b.value}).ratio(p/o*.5*(1+Math.sqrt(5))).round(!1),v=a.select("#breadcrumbTrail").append("svg").attr("width",o).attr("height","30px").attr("class","trail"),w=a.select("#legend").append("svg").attr("width",o).attr("height",30).attr("class","legend"),x=0,y=!1,z=a.select("#chart").append("svg").attr("width",o).attr("height",500).append("g").attr("height",p).style("shape-rendering","crispEdges");i()}(d3,HOLDINGS,SUB_INDUSTRY_MAP,SECTOR_IDS,symbol2subindustry,flareSectorMap);