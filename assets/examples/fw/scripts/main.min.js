!function(a,b,c,d,e,f){"use strict";function g(a,b,c,d,e){var f,g=[];for(var h in a)if(a.hasOwnProperty(h))if(f=a[h],f[b]==c){if(e)return f[e];if(!d)return f;g.push(f)}else{var i=String.prototype.split.call(b,"_");if(i.length>1&&f[i[0]][i[1]]==c)return e?f[i[0]][e]:f[i[0]]}return g}function h(a){a=a.replace("#","");var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),d=parseInt(a.substr(4,2),16),e=(299*b+587*c+114*d)/1e3;return e>=128?"black":"white"}function i(){a.json(n.join(""),function(d){function l(a){var d=f();for(var h in b)if(b.hasOwnProperty(h)){var i=b[h];i.symbol=h,i.price=g(a,"symbol",h,!1,"LastTradePriceOnly"),i.sub_industry_id=e[h],i.sub_industry_name=c[i.sub_industry_id].name,i.sector_id=parseInt(String(i.sub_industry_id).slice(0,2),10),i.value=Math.round(i.price*i.qty),n(d,i)}return m(d),d}function m(a){for(var b=a.children.length;b>0;){var c=a.children[--b];c.value||(c.children?m(c):a.children.splice(b,1))}}function n(a,b){var c=b.sub_industry_name;return a.name===c?(a.children=a.children||[],a.sector_id=b.sector_id,a.children.push(b),!0):a.children?(a.children.forEach(function(a){return n(a,b)?(a.sector_id=b.sector_id,!0):void 0}),!1):!1}function B(a){a.x=a.y=0,a.dx=o,a.dy=p,a.depth=0}function C(a){return(a._children=a.children)?a.value=a.children.reduce(function(a,b){return b.sector_id=b.children&&b.children.length?b.children[0].sector_id:b.sector_id,a+C(b)},0):a.value}function D(a){var b=[];return a+=14,b.push("0,0"),b.push(a+",0"),b.push(a+7+",15"),b.push(a+",30"),b.push("0,30"),b.push("7,15"),b.join(" ")}function E(b){y=0;var c=[];for(w.datum(b.parent).selectAll("g").remove(),c.unshift(b);b.parent;)c.unshift(b.parent),b=b.parent;for(var d=0;d<c.length;d++){var e=c[d],f=a.select(".trail").append("g");f.datum(e);var g=f.append("polygon").attr("fill",function(a){return s(a.sector_id)}).style("stroke","#dddddd"),i=f.append("text").text(""+e.name).attr("y",15).attr("x",d>0?12:8).attr("dy","0.35em").attr("class","breadcumb-text").style("fill",function(a){return h(s(a.sector_id))}),k=i[0][0].offsetWidth;g.attr("points",D(k)).on("click",function(a){j(a)}),f.attr("transform",function(){return"translate("+(10*d+y)+", 0)"}),y+=k+6}w.select(".trail").style("visibility","")}function F(a){a._children&&(v.nodes({_children:a._children}),a._children.forEach(function(b){b.x=a.x+b.x*a.dx,b.y=a.y+b.y*a.dy,b.dx*=a.dx,b.dy*=a.dy,b.parent=a,b.fill=h(s(b.sector_id)),F(b)}))}function G(a){function b(a,b){if(!k&&a){k=!0;var c=G(a),d=e.transition().duration(750),f=c.transition().duration(750);t.domain([a.x,a.x+a.dx]),u.domain([a.y,a.y+a.dy]),A.style("shape-rendering",null),0!==a.depth&&b&&A.selectAll(".depth").sort(function(a,b){return a.depth-b.depth}),c.selectAll("text").style("fill-opacity",0),d.selectAll("text").call(H).style("fill-opacity",0),f.selectAll("text").call(H).style("fill-opacity",1),d.selectAll("rect").call(I),f.selectAll("rect").call(I),d.remove().each("end",function(){A.style("shape-rendering","crispEdges"),k=!1}),k=!1}}function d(a){var d=x.append("g").attr("display","table-cell");a._children.forEach(function(a){var e=d.append("rect").attr("height","40px").attr("fill",s(a.sector_id)).attr("y",0).attr("overflow-x","visible").datum(a).on("click",b),f=d.append("text").text(function(){return g(c,"sector_id",a.sector_id,!1,"name")}).attr("y",17).attr("fill",h(s(a.sector_id))).on("click",b),i=f[0][0].offsetWidth;e.attr("width",i+17).attr("x",y),f.attr("x",8+y),y+=i+16}),z=!0}var e=A.insert("g").datum(a).attr("class","depth"),f=e.selectAll("g").data(a._children).enter().append("g");return f.filter(function(a){return a._children}).classed("children",!0).on("click",b),f.selectAll(".child").data(function(a){return a._children||[a]}).enter().append("rect").attr("class","child").call(I),f.append("text").attr("dy",".75em").attr("fill",h(s(a.sector_id))).text(function(a){return a.qty?[a.symbol,"$"+q(a.value)].join(" "):a.name}).call(H),f.append("text").attr("class","currency").attr("dy","1.75em").text(function(a){return r(a.value)}).call(H),f.append("rect").attr("class","parent").attr("fill",function(a){return s(a.sector_id)}).call(I),j=function(a){b(a,!0)},!z&&d(K),E(a),f}function H(a){a.attr("x",function(a){return t(a.x)+6}).attr("y",function(a){return u(a.y)+6}).attr("fill",function(a){return h(s(a.sector_id))})}function I(a){return a.attr("x",function(a){return t(a.x)}).attr("y",function(a){return u(a.y)}).attr("width",function(a){return t(a.x+a.dx)-t(a.x)}).attr("height",function(a){return u(a.y+a.dy)-u(a.y)}).attr("fill",function(a){return s(a.sector_id)}),a}d.query.results||i();var J=d.query.results.quote,K=l(J);B(K),C(K),F(K),G(K)})}var j,k,l=a.keys(b).join(","),m=['select symbol, LastTradePriceOnly from yahoo.finance.quotes where symbol in ("',l,'")'],n=["https://query.yahooapis.com/v1/public/yql?q=",m.join(" "),"&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys"],o=1e3,p=500,q=a.format(",d"),r=a.format("$,d"),s=a.scale.ordinal().domain(d).range(["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffffff","#b15928"]),t=a.scale.linear().domain([0,o]).range([0,o]),u=a.scale.linear().domain([0,p]).range([0,p]),v=a.layout.treemap().children(function(a,b){return b?null:a._children}).sort(function(a,b){return a.value-b.value}).ratio(p/o*.5*(1+Math.sqrt(5))).round(!1),w=a.select("#breadcrumbTrail").append("svg:svg").attr("width",o).attr("height",30).attr("class","trail"),x=a.select("#legend").append("svg").attr("width",o).attr("height",30).attr("class","legend"),y=0,z=!1,A=a.select("#chart").append("svg").attr("width",o).attr("height",500).append("g").attr("height",p).style("shape-rendering","crispEdges");i()}(d3,HOLDINGS,SUB_INDUSTRY_MAP,SECTOR_IDS,symbol2subindustry,flareSectorMap);